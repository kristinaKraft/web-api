<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excluir Produto</title>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        button {
            padding: 10px;
            background-color: #c548ff; 
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <button onclick="excluir()">Excluir Produto</button>

    <script>
        function excluir() {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                const idProduto = obterIdProduto();
                const token = localStorage.getItem('login');

                verificarPermissoes(token)
                    .then(permissaoAdmin => {
                        if (permissaoAdmin) {
                            fetch(`https://localhost:7193/api/Produtos/${idProduto}`, {
                                method: 'DELETE',
                                headers: {
                                    'Authorization': 'Bearer ' + token
                                }
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Erro ao excluir produto');
                                }
                                alert('Produto excluído com sucesso!');
                                window.location.href = './listarproduto.html';
                            })
                            .catch(error => {
                                console.error('Erro:', error.message);
                            });
                        } else {
                            alert('Você não tem permissão para excluir produtos.');
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao verificar permissões:', error.message);
                    });
            }
        }

        function obterIdProduto() {
            const params = new URLSearchParams(window.location.search);
            const idProduto = params.get('id');
            return idProduto;
        }

        async function verificarPermissoes(token) {
            const response = await fetch('https://localhost:7193/api/Usuarios/verificarPermissoes', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });

            if (response.ok) {
                const data = await response.json();
                return data.permissaoAdmin;
            } else {
                throw new Error('Erro ao verificar permissões: ' + response.statusText);
            }
        }
    </script>
</body>
</html>
